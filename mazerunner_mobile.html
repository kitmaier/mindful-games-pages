<!DOCTYPE html>
<html>
	<head>
	</head>
	<style>
	</style>
	<body id='body' onkeydown="bodyClick(event)">
		<p><a href="index.html">Return to games index</a></p>
		<h1>Maze Runner - Mobile</h1>
		<p>Pay attention to the animation below.
		You are a mouse, randomly exploring a maze.
		Try to keep track of your position in the maze,
		as well as the position of the cheese.
		When the animation stops, use the arrow keys
		to find your way back to the cheese.</p>
		<p><button id="toggleActive" type="button" onclick="toggleActive()">Push to Start</button></p>
		<b><p id="advice">Try to keep track of where the mouse is in the maze.</p></b>
		<p id="accuracy">Accuracy: </p>
		<p>
			<image id="leftArrow" src="images/button_left.PNG" onclick="arrowClick('L')"></image>
			<image id="upArrow" src="images/button_up.PNG" onclick="arrowClick('U')"></image>
			<image id="rightArrow" src="images/button_right.PNG" onclick="arrowClick('R')"></image>
			<image id="downArrow" src="images/button_down.PNG" onclick="arrowClick('D')"></image>
		</p>
		<!-- TODO: start at the cheese, wander randomly except keep track of where you have been and bias towards exploring under-explored areas, and also a bias to come back to the cheese periodically to check in -->
		<!-- TODO: allow the user to control the speed of the animation -->
		<!-- TODO: generate the entire map in the svg and just move a viewing window over it -->
		<!--p><button id="toggleActive" type="button" onclick="toggleActive()">Push to Start</button></p-->
		<svg id="svgId" height="480" width="480">
			<rect id="leftHall" x="0" y="200" width="200" height="40" stroke="#000000" stroke-width="1" fill="#000000" visibility="hidden">
				<animate id="leftToRight" attributeName="x" from="0" to="240" dur="1s" begin="indefinite" fill="remove" />
			</rect>
			<rect id="rightHall" x="240" y="200" width="200" height="40" stroke="#000000" stroke-width="1" fill="#000000" visibility="hidden">
				<animate id="rightToLeft" attributeName="x" from="240" to="0" dur="1s" begin="indefinite" fill="remove" />
			</rect>
			<rect id="topHall" x="200" y="0" width="40" height="200" stroke="#000000" stroke-width="1" fill="#000000" visibility="hidden">
				<animate id="topToBottom" attributeName="y" from="0" to="240" dur="1s" begin="indefinite" fill="remove" />
			</rect>
			<rect id="bottomHall" x="200" y="240" width="40" height="200" stroke="#000000" stroke-width="1" fill="#000000" visibility="hidden">
				<animate id="bottomToTop" attributeName="y" from="240" to="0" dur="1s" begin="indefinite" fill="remove" />
			</rect>
			<rect id="cheese" x="160" y="160" width="120" height="120" stroke="#000000" stroke-width="1" fill="#FFC000" visibility="hidden"/>
			<rect id="mouse" x="200" y="200" width="40" height="40" stroke="#000000" stroke-width="1" fill="#A0A0A0"/>
			Sorry, your browser does not support inline SVG.
		</svg>
		<script src="NoSleep.min.js"></script>
		<!-- TODO: ideas for maps - grid where cheese is in top left corner, grid where cheese is in middle, randomized densely packed tree where cheese is at root, randomized densely packed tree with small number of random cross-connections, various sizes -->
		<!-- TODO: name each map, maybe allow user to see map before/after game -->
		<!-- TODO: track timing metrics -->
		<!-- TODO: maps where local environment looks similar everywhere -->
		<!-- TODO: maps where the edges loop back -->
		<!-- TODO: store maps in separate file -->
		<!-- TODO: select map name from dropdown -->
		<!-- TODO: accumulate/average scores, add some explanatory text about how scores are calculated, add raw data text element -->
		<!-- TODO: allow user to select exploration strategy from dropdown - random, reduced backtracking, exploratory, periodic -->
		<script>
			var state = "none"
			var randomStepsLeft = 10
			var position = [2,2]
			var lastMotion = "X"
			var map = [[{"C":0,"L":0,"R":1,"U":0,"D":1},
							{"C":0,"L":1,"R":1,"U":0,"D":1},
								{"C":0,"L":1,"R":1,"U":0,"D":1},
									{"C":0,"L":1,"R":1,"U":0,"D":1},
										{"C":0,"L":1,"R":0,"U":0,"D":1}],
						[{"C":0,"L":0,"R":1,"U":1,"D":1},
							{"C":0,"L":1,"R":1,"U":1,"D":1},
								{"C":0,"L":1,"R":1,"U":1,"D":1},
									{"C":0,"L":1,"R":1,"U":1,"D":1},
										{"C":0,"L":1,"R":0,"U":1,"D":1}],
						[{"C":0,"L":0,"R":1,"U":1,"D":1},
							{"C":0,"L":1,"R":1,"U":1,"D":1},
								{"C":1,"L":1,"R":1,"U":1,"D":1},
									{"C":0,"L":1,"R":1,"U":1,"D":1},
										{"C":0,"L":1,"R":0,"U":1,"D":1}],
						[{"C":0,"L":0,"R":1,"U":1,"D":1},
							{"C":0,"L":1,"R":1,"U":1,"D":1},
								{"C":0,"L":1,"R":1,"U":1,"D":1},
									{"C":0,"L":1,"R":1,"U":1,"D":1},
										{"C":0,"L":1,"R":0,"U":1,"D":1}],
						[{"C":0,"L":0,"R":1,"U":1,"D":0},
							{"C":0,"L":1,"R":1,"U":1,"D":0},
								{"C":0,"L":1,"R":1,"U":1,"D":0},
									{"C":0,"L":1,"R":1,"U":1,"D":0},
										{"C":0,"L":1,"R":0,"U":1,"D":0}]]
			var mapPars = [[4,3,2,3,4],[3,2,1,2,3],[2,1,0,1,2],[3,2,1,2,3],[4,3,2,3,4]]
			var directedPathStart = [2,2]
			var directedPathLength = 0
			var noSleep = new NoSleep()
			var sleepStatus = "asleep"
			function toggleActive() {
				if(sleepStatus=="asleep") {
					sleepStatus = "awake"
					noSleep.enable()
					document.getElementById("toggleActive").textContent = "Push to Stop"
					state = "random"
					randomStepsLeft = Math.floor(Math.random()*20)
					position = [2,2]
					lastMotion = "X"
					resetImage()
				} else {
					sleepStatus = "asleep"
					noSleep.disable()
					document.getElementById("toggleActive").textContent = "Push to Start"
					state = "none"
					randomStepsLeft = Math.floor(Math.random()*20)
					position = [2,2]
					lastMotion = "X"
					resetImage()
				}
			}
			function resetImage() {
			// TODO: figure out how to get SVG event timings to work properly so that rect does not reset to initial position while still visible
			//alert(document.getElementById("svgId").getCurrentTime())
			//alert(document.getElementById("leftToRight").getAttribute("begin"))
			//document.getElementById("leftToRight").endElement()
			//document.getElementById("leftToLeft").beginElement()
				document.getElementById("cheese").style.visibility = "hidden"
				document.getElementById("leftHall").style.visibility = "hidden"
				document.getElementById("rightHall").style.visibility = "hidden"
				document.getElementById("topHall").style.visibility = "hidden"
				document.getElementById("bottomHall").style.visibility = "hidden"
				if(map[position[0]][position[1]]["C"]==1) {
					document.getElementById("cheese").style.visibility = "visible"
				}
				if(map[position[0]][position[1]]["L"]==1) {
					document.getElementById("leftHall").style.visibility = "visible"
				}
				if(map[position[0]][position[1]]["R"]==1) {
					document.getElementById("rightHall").style.visibility = "visible"
				}
				if(map[position[0]][position[1]]["U"]==1) {
					document.getElementById("topHall").style.visibility = "visible"
				}
				if(map[position[0]][position[1]]["D"]==1) {
					document.getElementById("bottomHall").style.visibility = "visible"
				}
				if(state=="random"&&randomStepsLeft<=0) {
					state = "directed-waiting"
					document.getElementById("advice").innerHTML = "Use the arrow keys or the buttons to find your way back to the cheese."
					// TODO: why doesn't this update correctly when I set the list variable directly, why do I have to set individual elements?
					directedPathStart[0] = position[0]
					directedPathStart[1] = position[1]
					directedPathLength = 0
				}
				if((state=="directed-waiting"||state=="directed-moving")&&map[position[0]][position[1]]["C"]==1) {
					state = "random"
					randomStepsLeft = Math.floor(Math.random()*20)
					document.getElementById("advice").innerHTML = "Well done! Try to keep track of where the mouse is in the maze."
					if(directedPathLength>0) {
						var par = mapPars[directedPathStart[0]][directedPathStart[1]]
						var score = par/directedPathLength
						document.getElementById("accuracy").textContent = "Accuracy: "+Math.floor(score*100)+"% ("+directedPathLength+" steps on par "+par+")"
					}
				}
				if(state=="random") {
					randomStepsLeft = randomStepsLeft-1
					setTimeout(moveRandom,1000)
				} else if(state=="directed-moving") {
					state="directed-waiting"
					// wait for bodyClick event
				}
			}
			resetImage()
			function animateLeftToRight() {
				document.getElementById("cheese").style.visibility = "hidden"
				document.getElementById("rightHall").style.visibility = "hidden"
				document.getElementById("topHall").style.visibility = "hidden"
				document.getElementById("bottomHall").style.visibility = "hidden"
				document.getElementById("leftToRight").beginElement()
				setTimeout(resetImage,1000)
			}
			function animateRightToLeft() {
				document.getElementById("cheese").style.visibility = "hidden"
				document.getElementById("leftHall").style.visibility = "hidden"
				document.getElementById("topHall").style.visibility = "hidden"
				document.getElementById("bottomHall").style.visibility = "hidden"
				document.getElementById("rightToLeft").beginElement()
				setTimeout(resetImage,1000)
			}
			function animateTopToBottom() {
				document.getElementById("cheese").style.visibility = "hidden"
				document.getElementById("leftHall").style.visibility = "hidden"
				document.getElementById("rightHall").style.visibility = "hidden"
				document.getElementById("bottomHall").style.visibility = "hidden"
				document.getElementById("topToBottom").beginElement()
				setTimeout(resetImage,1000)
			}
			function animateBottomToTop() {
				document.getElementById("cheese").style.visibility = "hidden"
				document.getElementById("leftHall").style.visibility = "hidden"
				document.getElementById("rightHall").style.visibility = "hidden"
				document.getElementById("topHall").style.visibility = "hidden"
				document.getElementById("bottomToTop").beginElement()
				setTimeout(resetImage,1000)
			}
			function moveRandom() {
				if(state!="random") return;
				var options = []
				if(map[position[0]][position[1]]["L"]==1) {
					options.push("L")
					if(lastMotion!="R") {
						options.push("L")
						options.push("L")
						options.push("L")
					}
				}
				if(map[position[0]][position[1]]["R"]==1) {
					options.push("R")
					if(lastMotion!="L") {
						options.push("R")
						options.push("R")
						options.push("R")
					}
				}
				if(map[position[0]][position[1]]["U"]==1) {
					options.push("U")
					if(lastMotion!="D") {
						options.push("U")
						options.push("U")
						options.push("U")
					}
				}
				if(map[position[0]][position[1]]["D"]==1) {
					options.push("D")
					if(lastMotion!="U") {
						options.push("D")
						options.push("D")
						options.push("D")
					}
				}
				var option = options[Math.floor(Math.random()*options.length)]
				lastMotion = option
				if(option=="L") {
					animateLeftToRight()
					position[1] = position[1]-1
					return
				}
				if(option=="R") {
					animateRightToLeft()
					position[1] = position[1]+1
					return
				}
				if(option=="U") {
					animateTopToBottom()
					position[0] = position[0]-1
					return
				}
				if(option=="D") {
					animateBottomToTop()
					position[0] = position[0]+1
					return
				}
			}
			function bodyClick(event) {
				var x = event.keyCode;
				if (x == '37') {
					arrowClick("L")
				} else if (x == '39') {
					arrowClick("R")
				} else if (x == '38') {
					arrowClick("U")
				} else if (x == '40') {
					arrowClick("D")
				}
			}
			function arrowClick(optionChar) {
				if(state!="directed-waiting") return;
				if(map[position[0]][position[1]][optionChar]==0) return;
				state = "directed-moving"
				directedPathLength = directedPathLength+1
				if (optionChar=="L") {
					animateLeftToRight()
					position[1] = position[1]-1
				} else if(optionChar=="R") {
					animateRightToLeft()
					position[1] = position[1]+1
				} else if(optionChar=="U") {
					animateTopToBottom()
					position[0] = position[0]-1
				} else if(optionChar=="D") {
					animateBottomToTop()
					position[0] = position[0]+1
				}
			}
		</script>
	</body>
</html>