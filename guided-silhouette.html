<!DOCTYPE html>
<html>
	<head>
		<title>Guided Body Scan Meditation</title>
		<meta name="description" content="Relax with a meditation game that will guide you through gaining a deeper awareness of your body.">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body id='body'>
		<p><a href="index.html">Return to games index</a></p>
		<h1>Guided Body Scan Meditation</h1>
		<p>Direct your attention to sensations <br/>in the lightened part of the body below, <br/>looking at it as though it was in a mirror.</p>
		<p><button id="toggleActive" type="button" onclick="toggleActive()">Push to Start</button></p>
		<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
			<path id="bodyPathId" d="M 95 170 C 95 190, 95 190, 90 190 L 60 190 C 50 190, 50 170, 60 170 C 80 170, 80 150, 80 130 L 80 110 C 80 80, 80 80, 60 110 C 60 130, 40 130, 40 110 C 30 110, 30 100, 40 100 C 60 80, 60 60, 80 60 C 100 60, 90 50, 80 40 C 75 35, 75 25, 80 20 C 90 10, 110 10, 120 20 C 125 25, 125 35, 120 40 C 110 50, 100 60, 120 60 C 140 60, 140 80, 160 100 C 170 100, 170 110, 160 110 C 160 130, 140 130, 140 110 C 120 80, 120 80, 120 110 L 120 130 C 120 150, 120 170, 140 170 C 150 170, 150 190, 140 190 L 110 190 C 105 190, 105 190, 105 170 C 100 110, 100 110, 95 170 Z" stroke="transparent" fill="#3333AA" visibility="visible"/>
			<path id="leftFootPathId" d="M 95 170 C 95 190, 95 190, 90 190 L 60 190 C 50 190, 50 170, 60 170 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftLegPathId" d="M 60 170 C 80 170, 80 150, 80 130 L 98.42 132.2 C 97.55 139.4, 96.5 152, 95 170 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="pelvisPathId" d="M 80 110 L 80 130 L 98.42 132.2 C 99.61 122.6, 100.4 122.6, 101.6 132.2 L 120 130 L 120 110 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightLegPathId" d="M 101.6 132.2 C 102.5 139.4, 103.5 152, 105 170 L 140 170 C 120 170 120 150 120 130 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFootPathId" d="M 105 170 C 105 190, 105 190, 110 190 L 140 190 C 150 190, 150 170, 140 170 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftHandPathId" d="M 40 100 C 30 100, 30 110, 40 110 C 40 130, 60 130, 60 110 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightHandPathId" d="M 160 100 C 170 100, 170 110, 160 110 C 160 130, 140 130, 140 110 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightArmPathId" d="M 160 100 L 140 110 C 130 95, 125 87.5, 122.5 87.5 L 120 60 C 140 60, 140 80, 160 100 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftArmPathId" d="M 40 100 L 60 110 C 70 95, 75 87.5, 77.5 87.5 L 80 60 C 60 60, 60 80, 40 100 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="chestPathId" d="M 122.5 87.5 C 120 87.5, 120 95, 120 110 L 80 110 C 80 95, 80 87.5, 77.5 87.5 L 80 60 C 90 70, 110 70, 120 60 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="headPathId" d="M 80 40 C 75 35, 75 25, 80 20 C 90 10, 110 10, 120 20 C 125 25, 125 35, 120 40 C 110 50, 90 50, 80 40 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="neckPathId" d="M 120 40 C 110 50, 90 50, 80 40 C 90 50, 100 60, 80 60 C 90 70, 110 70, 120 60 C 100 60, 110 50, 120 40 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="bodyOutlinePathId" d="M 95 170 C 95 190, 95 190, 90 190 L 60 190 C 50 190, 50 170, 60 170 C 80 170, 80 150, 80 130 L 80 110 C 80 80, 80 80, 60 110 C 60 130, 40 130, 40 110 C 30 110, 30 100, 40 100 C 60 80, 60 60, 80 60 C 100 60, 90 50, 80 40 C 75 35, 75 25, 80 20 C 90 10, 110 10, 120 20 C 125 25, 125 35, 120 40 C 110 50, 100 60, 120 60 C 140 60, 140 80, 160 100 C 170 100, 170 110, 160 110 C 160 130, 140 130, 140 110 C 120 80, 120 80, 120 110 L 120 130 C 120 150, 120 170, 140 170 C 150 170, 150 190, 140 190 L 110 190 C 105 190, 105 190, 105 170 C 100 110, 100 110, 95 170 Z" stroke="black" fill="transparent" visibility="visible"/>
			<path id="facePart1PathId" d="M 50 30 C 70 10, 130 10, 150 30 C 180 70, 160 140, 150 150 C 120 190, 80 190, 50 150 C 40 140, 20 70, 50 30 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="nosePathId" d="M 95 90 L 95 95 C 90 100, 90 110, 100 110 C 110 110, 110 100, 105 95 L 105 90 C 105 85, 95 85, 95 90 Z" cx="100" cy="100" rx="10" ry="10" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="leftEyePathId" cx="75" cy="75" rx="15" ry="8" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="rightEyePathId" cx="125" cy="75" rx="15" ry="8" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="lipsPathId" d="M 75 130 C 85 128, 115 128, 125 130 C 115 145, 85 145, 75 130 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="chinPathId" cx="100" cy="170" rx="20" ry="10" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="leftCheekPathId" cx="55" cy="115" rx="15" ry="20" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="rightCheekPathId" cx="145" cy="115" rx="15" ry="20" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="leftJawPathId" cx="45" cy="80" rx="8" ry="12" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="rightJawPathId" cx="155" cy="80" rx="8" ry="12" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="foreheadPathId" cx="100" cy="50" rx="30" ry="15" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<ellipse id="facePart2PathId" cx="75" cy="75" rx="10" ry="5" stroke="white" fill="transparent" visibility="hidden"/>
			<ellipse id="facePart3PathId" cx="75" cy="75" rx="3" ry="4" stroke="white" fill="white" visibility="hidden"/>
			<ellipse id="facePart4PathId" cx="125" cy="75" rx="10" ry="5" stroke="white" fill="transparent" visibility="hidden"/>
			<ellipse id="facePart5PathId" cx="125" cy="75" rx="3" ry="4" stroke="white" fill="white" visibility="hidden"/>
			<path id="facePart6PathId" d="M 95 90 L 95 95 C 90 100, 90 110, 100 110 C 110 110, 110 100, 105 95 L 105 90" cx="100" cy="100" rx="10" ry="10" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="facePart7PathId" d="M 75 130 C 85 128, 115 128, 125 130" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="facePart8PathId" d="M 75 130 C 85 136, 115 136, 125 130" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="facePart9PathId" d="M 75 130 C 85 145, 115 145, 125 130" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="facePart1OutlinePathId" d="M 50 30 C 70 10, 130 10, 150 30 C 180 70, 160 140, 150 150 C 120 190, 80 190, 50 150 C 40 140, 20 70, 50 30 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="sideFacePathId" d="M 90 180 C 90 160, 90 160, 60 160 C 40 160, 60 130, 50 120 C 35 110, 35 110, 50 90 C 60 80, 40 60, 60 40 C 80 20, 140 20, 160 40 C 170 50, 170 90, 160 100 C 140 130, 150 150, 160 180 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="lowerTeethPathId" d="M 60 150 L 90 150 L 90 140 L 60 140 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="lowerTeethOutlinePathId" d="M 60 150 L 90 150 L 90 140 L 60 140 Z" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="upperTeethPathId" d="M 60 130 L 90 130 L 90 120 L 60 120 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="upperTeethOutlinePathId" d="M 60 130 L 90 130 L 90 120 L 60 120 Z" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="tonguePathId" d="M 60 130 C 53 130, 53 140, 60 140 L 90 140 C 100 140, 100 150, 100 160 L 110 160 C 110 140, 110 130, 90 130 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="tongueOutlinePathId" d="M 60 130 C 53 130, 53 140, 60 140 L 90 140 C 100 140, 100 150, 100 160 L 110 160 C 110 140, 110 130, 90 130 Z" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="sinusPathId" d="M 110 160 C 110 130, 110 110, 100 110 L 50 110 C 40 110, 50 90, 70 90 L 100 90 C 130 90, 130 130, 130 160 L 130 170 L 110 170 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="sinusOutlinePathId" d="M 110 160 C 110 130, 110 110, 100 110 L 50 110 C 40 110, 50 90, 70 90 L 100 90 C 130 90, 130 130, 130 160 L 130 170 L 110 170 Z" stroke="white" fill="transparent" visibility="hidden"/>
			<path id="sideFaceOutlinePathId" d="M 90 180 C 90 160, 90 160, 60 160 C 40 160, 60 130, 50 120 C 35 110, 35 110, 50 90 C 60 80, 40 60, 60 40 C 80 20, 140 20, 160 40 C 170 50, 170 90, 160 100 C 140 130, 150 150, 160 180 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftFootBottomPathId" d="M 80 80 C 100 60, 80 40, 50 50 C 20 60, 20 70, 30 90 C 40 110, 40 130, 40 150 C 40 160, 40 185, 60 185 C 80 185, 85 170, 80 150 C 70 130, 60 100, 80 80 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightFootBottomPathId" d="M 120 80 C 100 60, 120 40, 150 50 C 180 60, 180 70, 170 90 C 160 110, 160 130, 160 150 C 160 160, 160 185, 140 185 C 120 185, 115 170, 120 150 C 130 130, 140 100, 120 80 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftFootBallPathId" d="M 80 80 C 100 60, 80 40, 50 50 C 20 60, 20 70, 30 90 C 40 100, 70 90, 80 80 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFootBallPathId" d="M 120 80 C 100 60, 120 40, 150 50 C 180 60, 180 70, 170 90 C 160 100, 130 90, 120 80 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftFootHeelPathId" d="M 40 150 C 40 160, 40 185, 60 185 C 80 185, 85 170, 80 150 C 70 140, 50 140, 40 150 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFootHeelPathId" d="M 160 150 C 160 160, 160 185, 140 185 C 120 185, 115 170, 120 150 C 130 140, 150 140, 160 150 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftFootArchPathId" d="M 80 150 C 70 130, 60 100, 80 80 C 40 100, 40 130, 80 150 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFootArchPathId" d="M 120 150 C 130 130, 140 100, 120 80 C 160 100, 160 130, 120 150 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftFootSolePathId" d="M 80 80 C 100 60, 80 40, 50 50 C 20 60, 20 70, 30 90 C 40 110, 40 130, 40 150 C 40 160, 40 185, 60 185 C 80 185, 85 170, 80 150 C 40 130, 40 100, 80 80 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFootSolePathId" d="M 120 80 C 100 60, 120 40, 150 50 C 180 60, 180 70, 170 90 C 160 110, 160 130, 160 150 C 160 160, 160 185, 140 185 C 120 185, 115 170, 120 150 C 160 130, 160 100, 120 80 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftFootBottomOutlinePathId" d="M 80 80 C 100 60, 80 40, 50 50 C 20 60, 20 70, 30 90 C 40 110, 40 130, 40 150 C 40 160, 40 185, 60 185 C 80 185, 85 170, 80 150 C 70 130, 60 100, 80 80 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightFootBottomOutlinePathId" d="M 120 80 C 100 60, 120 40, 150 50 C 180 60, 180 70, 170 90 C 160 110, 160 130, 160 150 C 160 160, 160 185, 140 185 C 120 185, 115 170, 120 150 C 130 130, 140 100, 120 80 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftBigToeDarkPathId" d="M 80 15 a 10 15, 10, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftSecondToeDarkPathId" d="M 58 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftMiddleToeDarkPathId" d="M 44 28 a 5 8, -5, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftFourthToeDarkPathId" d="M 32 36 a 5 7, -10, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftPinkyToeDarkPathId" d="M 21 45 a 5 6, -15, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="leftBigToeBrightPathId" d="M 80 15 a 10 15, 10, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftSecondToeBrightPathId" d="M 58 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftMiddleToeBrightPathId" d="M 44 28 a 5 8, -5, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftFourthToeBrightPathId" d="M 32 36 a 5 7, -10, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftPinkyToeBrightPathId" d="M 21 45 a 5 6, -15, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="leftBigToeOutlinePathId" d="M 80 15 a 10 15, 10, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftSecondToeOutlinePathId" d="M 58 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftMiddleToeOutlinePathId" d="M 44 28 a 5 8, -5, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftFourthToeOutlinePathId" d="M 32 36 a 5 7, -10, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="leftPinkyToeOutlinePathId" d="M 21 45 a 5 6, -15, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightBigToeDarkPathId" d="M 120 15 a 10 15, -10, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightSecondToeDarkPathId" d="M 142 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightMiddleToeDarkPathId" d="M 156 28 a 5 8, 5, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightFourthToeDarkPathId" d="M 168 36 a 5 7, 10, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightPinkyToeDarkPathId" d="M 179 45 a 5 6, 15, 1 0, 0.01 0 Z" stroke="transparent" fill="#3333AA" visibility="hidden"/>
			<path id="rightBigToeBrightPathId" d="M 120 15 a 10 15, -10, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightSecondToeBrightPathId" d="M 142 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightMiddleToeBrightPathId" d="M 156 28 a 5 8, 5, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightFourthToeBrightPathId" d="M 168 36 a 5 7, 10, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightPinkyToeBrightPathId" d="M 179 45 a 5 6, 15, 1 0, 0.01 0 Z" stroke="transparent" fill="#FFFF00" visibility="hidden"/>
			<path id="rightBigToeOutlinePathId" d="M 120 15 a 10 15, -10, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightSecondToeOutlinePathId" d="M 142 22 a 6 9, 0, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightMiddleToeOutlinePathId" d="M 156 28 a 5 8, 5, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightFourthToeOutlinePathId" d="M 168 36 a 5 7, 10, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
			<path id="rightPinkyToeOutlinePathId" d="M 179 45 a 5 6, 15, 1 0, 0.01 0 Z" stroke="black" fill="transparent" visibility="hidden"/>
		</svg>
		<p id="bodypart"></p>
		<button id="toggleAudio" type="button" onclick="toggleAudio()">Audio Disabled</button>
		<button id="toggleAudioCapture" type="button" onclick="toggleAudioCapture()">Audio Capture Disabled</button>
		<button id="toggleTextConversion" type="button" onclick="toggleTextConversion()">Speech-to-Text Disabled</button>
		<p>To customize what is included in the scan, <br/>you can modify the below options.</p>
		<p id='options'></p>
		<p id='audio'></p>
		<script type="text/javascript" src="generic-logging-client-function.js"></script>
		<script src="NoSleep.min.js"></script>
		<script src="web_audio_recorder_js/WebAudioRecorder.js"></script>
		<script>
			// TODO: do something about these two errors: 
			//    guidedsilhouette.html:1 Access to XMLHttpRequest at 'https://yzb3dh02l8.execute-api.us-west-2.amazonaws.com/default/myFunction-3?game=guidedsilhouette&ip=104.1.54.246&session=0.0664505495303993&timestamp=1574037009780&sequence=1&data=%5B%22startGame%22%5D' from origin 'null' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
			//    guidedsilhouette.html:480 Cross-Origin Read Blocking (CORB) blocked cross-origin response https://yzb3dh02l8.execute-api.us-west-2.amazonaws.com/default/myFunction-3?game=guidedsilhouette&ip=104.1.54.246&session=0.0664505495303993&timestamp=1574037009780&sequence=1&data=%5B%22startGame%22%5D with MIME type application/json. See https://www.chromestatus.com/feature/5629709824032768 for more details.
			// TODO: try auto-pushing the button to enable recording with an artifical button press https://stackoverflow.com/questions/21012580/is-it-possible-to-write-data-to-file-using-only-javascript
			// TODO: provide download link for audio recordings https://stackoverflow.com/questions/21012580/is-it-possible-to-write-data-to-file-using-only-javascript
			// TODO: search converted speech-to-text data for a keyword like "Stop" to indicate the chosen end of recording, so the user does not have to push a button
			// TODO: trim out silence or non-speech sounds from recording before submitting for speech-to-text conversion
			/** START GAME STATE SECTION **/
				// Sleep state handling
					var noSleep = new NoSleep()
					var sleepStatus = "sleepAllowed"
					function setSleepStatus(newSleepStatus) {
						if(newSleepStatus=="sleepAllowed") {
							noSleep.disable()
							sleepStatus = "sleepAllowed"
						} else if(newSleepStatus=="wakeLocked") {
							noSleep.enable()
							sleepStatus = "wakeLocked"
						}
					}
				// State transition handling
					var state = "inactive"
					function toggleActive() {
						if(state=="inactive"||state=="paused") {
							changeStateTo("active")
						} else if(state=="active") {
							changeStateTo("inactive")
						}
					}
					function stopGame() {
						changeStateTo("inactive")
					}
					function changeStateTo(newState) {
						// TODO: add locking/queueing to handle concurrent events (or maybe is not needed??? https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)
						clearTimeout(timerId)
						darkenSilhouette()
						stopAudio()
						if(newState=="active") {
							state = "active"
							logEvent("guidedsilhouette",["event=startGame"])
							setSleepStatus("wakeLocked")
							document.getElementById("toggleActive").textContent = "Push to Stop"
							stopAudioCapture()
							stepsUntilPause = Math.floor(Math.random()*20)+3
							brightenOnRandomSchedule()
						} else if(newState=="inactive") {
							state = "inactive"
							logEvent("guidedsilhouette",["event=stopGame"])
							setSleepStatus("sleepAllowed")
							document.getElementById("toggleActive").textContent = "Push to Start"
							stopAudioCapture()
							displayBodyPartName("Stopped")
						} else if(newState=="paused") {
							state = "inactive"
							logEvent("guidedsilhouette",["event=pauseGame"])
							setSleepStatus("wakeLocked")
							document.getElementById("toggleActive").textContent = "Push to Unpause"
							startAudioCapture()
							displayBodyPartName("Unpause")
							timerId = setTimeout(stopGame, 2*60*1000)
						}
					}
				// Random event handling
					var timerId = null
					var stepsUntilPause = 0
					function brightenOnRandomSchedule() {
						if(stepsUntilPause>0) {
							stepsUntilPause -= 1
							// TODO: allow timing parameters to be set by user
							brightenRandomBodyPart()
							var timeoutValue = 7+Math.floor(Math.random()*25)
							if(isSpeedTest()) {
								timeoutValue = 7
							}
							timerId = setTimeout(brightenOnRandomSchedule, timeoutValue*1000)
						} else {
							changeStateTo("paused")
						}
						// TODO: prevent the same event from happening twice in a row
						// TODO: break in with other random events sometimes, such as instructions, questions, and reminders
					}
				// Superuser options
					function isSpeedTest() {
						var params = new URLSearchParams(window.location.search);
						return params!=null && params.has('test') && params.get('test')=='speed';
					}
			/** END GAME STATE SECTION **/
			/** START AUDIO SECTION **/
				// TODO: try using build in HTML5 Speech Synthesis API (https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis)
				// Initialize static data
					var audioFiles = {}
					setupAudio()
					function setupAudio() {
						audioFiles["Left Hand"] = new Audio("audio/left-hand.mp3")
						audioFiles["Right Hand"] = new Audio("audio/right-hand.mp3")
						audioFiles["Left Arm"] = new Audio("audio/left-arm.mp3")
						audioFiles["Right Arm"] = new Audio("audio/right-arm.mp3")
						audioFiles["Head & Face"] = new Audio("audio/head-and-face.mp3")
						audioFiles["Neck & Shoulders"] = new Audio("audio/neck-and-shoulders.mp3")
						audioFiles["Chest & Back"] = new Audio("audio/chest-and-back.mp3")
						audioFiles["Pelvis & Belly"] = new Audio("audio/pelvis-and-belly.mp3")
						audioFiles["Left Leg"] = new Audio("audio/left-leg.mp3")
						audioFiles["Right Leg"] = new Audio("audio/right-leg.mp3")
						audioFiles["Left Foot"] = new Audio("audio/left-foot.mp3")
						audioFiles["Right Foot"] = new Audio("audio/right-foot.mp3")
						audioFiles["Click Somewhere"] = new Audio("audio/click-somewhere.mp3")
						audioFiles["Unpause"] = new Audio("audio/unpause.mp3")
						audioFiles["Chin"] = new Audio("audio/chin.mp3")
						audioFiles["Forehead"] = new Audio("audio/forehead.mp3")
						audioFiles["Jaw Muscles"] = new Audio("audio/jaw-muscles.mp3")
						audioFiles["Left Cheek"] = new Audio("audio/left-cheek.mp3")
						audioFiles["Right Cheek"] = new Audio("audio/right-cheek.mp3")
						audioFiles["Left Eye"] = new Audio("audio/left-eye.mp3")
						audioFiles["Right Eye"] = new Audio("audio/right-eye.mp3")
						audioFiles["Lips"] = new Audio("audio/lips.mp3")
						audioFiles["Nose"] = new Audio("audio/nose.mp3")
						audioFiles["Teeth & Gums"] = new Audio("audio/teeth-gums.mp3")
						audioFiles["Throat & Sinuses"] = new Audio("audio/throat-sinuses.mp3")
						audioFiles["Tongue & Mouth"] = new Audio("audio/tongue-roof.mp3")
						audioFiles["Digestion"] = new Audio("audio/digestion.mp3")
						audioFiles["Heart & Pulse"] = new Audio("audio/heart-pulse.mp3")
						audioFiles["Lungs & Breath"] = new Audio("audio/lungs-breath.mp3")
						audioFiles["Eye Direction"] = new Audio("audio/direction-eyes.mp3")
						audioFiles["On Mind"] = new Audio("audio/on-mind.mp3")
						audioFiles["Gravity"] = new Audio("audio/gravity.mp3")
						audioFiles["Cloth"] = new Audio("audio/cloth.mp3")
						audioFiles["Heat & Cold"] = new Audio("audio/heat.mp3")
						audioFiles["Tesion & Relaxation"] = new Audio("audio/tension.mp3")
						audioFiles["Sounds"] = new Audio("audio/sounds.mp3")
						audioFiles["Inner Voice"] = new Audio("audio/inner-voice.mp3")
						audioFiles["Fast Scan"] = new Audio("audio/fast-scan.mp3")
						audioFiles["Mood"] = new Audio("audio/mood.mp3")
						audioFiles["Left Big Toe"] = new Audio("audio/left-big-toe.mp3")
						audioFiles["Left Second Toe"] = new Audio("audio/left-second-toe.mp3")
						audioFiles["Left Middle Toe"] = new Audio("audio/left-middle-toe.mp3")
						audioFiles["Left Fourth Toe"] = new Audio("audio/left-fourth-toe.mp3")
						audioFiles["Left Pinky Toe"] = new Audio("audio/left-little-toe.mp3")
						audioFiles["Left Foot Ball"] = new Audio("audio/left-foot-ball.mp3")
						audioFiles["Left Foot Heel"] = new Audio("audio/left-heel.mp3")
						audioFiles["Left Foot Arch"] = new Audio("audio/left-foot-arch.mp3")
						audioFiles["Right Big Toe"] = new Audio("audio/right-big-toe.mp3")
						audioFiles["Right Second Toe"] = new Audio("audio/right-second-toe.mp3")
						audioFiles["Right Middle Toe"] = new Audio("audio/right-middle-toe.mp3")
						audioFiles["Right Fourth Toe"] = new Audio("audio/right-fourth-toe.mp3")
						audioFiles["Right Pinky Toe"] = new Audio("audio/right-little-toe.mp3")
						audioFiles["Right Foot Ball"] = new Audio("audio/right-foot-ball.mp3")
						audioFiles["Right Foot Heel"] = new Audio("audio/right-heel.mp3")
						audioFiles["Right Foot Arch"] = new Audio("audio/right-foot-arch.mp3")
					}
				// Manage events and states
					var audioStatus = "disabled"
					var activeRecording = null
					function toggleAudio() {
						if(audioStatus=="disabled") {
							audioStatus = "enabled"
							logEvent("guidedsilhouette",["event=enableAudio"])
							document.getElementById("toggleAudio").textContent = "Audio Enabled"
						} else {
							audioStatus = "disabled"
							logEvent("guidedsilhouette",["event=disableAudio"])
							document.getElementById("toggleAudio").textContent = "Audio Disabled"
							stopAudio()
						}
					}
					function playAudio(bodyPart) {
						// This must be preceded by a gesture (button press)
						if(audioStatus=="enabled") {
							stopAudio()
							var audioFile = audioFiles[bodyPart]
							audioFile.play()
							activeRecording = audioFile
						}
					}
					function stopAudio() {
						if(activeRecording!=null) {
							activeRecording.pause();
							activeRecording.currentTime = 0;
							activeRecording = null
						}
					}
			/** END AUDIO SECTION **/
			/** START AUDIO CAPTURE SECTION **/
				// Using this library for audio capture https://www.npmjs.com/package/web-audio-recorder-js
				// Must run chrome with this flag (--allow-file-access-from-files) to test locally
				// TODO: expand speech-to-text capability https://codeburst.io/html5-speech-recognition-api-670846a50e92)
				// initialize audio capture
					var recorder = null;
					var audioContext = null;
					var audioDestination = null;
					var audioCaptureState = "uninitialized"
					function initializeAudioCapture() {
						// This must be preceded by a gesture (button press)
						audioCaptureState = "disabled";
						audioContext = new AudioContext();
						if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
							navigator.mediaDevices.getUserMedia({audio:true}).then(
								function(stream) {
									start_microphone(stream);
								},
								function(error){
									alert('Error capturing audio.');
								}
							)
						} else {
							alert('navigator.mediaDevices.getUserMedia not supported in this browser.');
						}
					}
					function start_microphone(stream) {
						var microphone_stream = audioContext.createMediaStreamSource(stream);
						var gain_node = audioContext.createGain();
						//gain_node.gain.value = 10;
						microphone_stream.connect(gain_node);
						audioDestination = gain_node;
					}
				// enable/disable audio capture
					function toggleAudioCapture() {
						if(audioCaptureState=="uninitialized") {
							initializeAudioCapture();
						}
						if(audioCaptureState=="disabled") {
							audioCaptureState = "enabled";
							document.getElementById("toggleAudioCapture").textContent = "Audio Capture Enabled"
						} else if(audioCaptureState=="enabled") {
							audioCaptureState = "disabled";
							document.getElementById("toggleAudioCapture").textContent = "Audio Capture Disabled"
						} else if(audioCaptureState=="recording") {
							stopAudioCapture();
							audioCaptureState = "disabled";
							document.getElementById("toggleAudioCapture").textContent = "Audio Capture Disabled"
						}
					}
				// functions to start and stop audio capture
					// TODO: should i keep the same variables or recreate them each time? is there any risk of a memory leak or other buildup over time?
					// TODO: should i delay the start of recording until after the command has finished?
					// TODO: give explicit instruction to user to speak during audio capture
					// TODO: store recording into database as clob and provide way to retrieve/play
					// TODO: process recording through speech-to-text and store text in database for later analysis
					function startAudioCapture() {
						if(audioCaptureState=="enabled") {
							audioCaptureState = "recording"
							// TODO: notify user while recording is active
							recorder = new WebAudioRecorder(audioDestination, {
								workerDir: "web_audio_recorder_js/", // must end with slash
								encoding: "wav",
								numChannels:1, //2 is the default, mp3 encoding supports only 2
								onEncoderLoading: function(recorder, encoding) {
									// show "loading encoder..." display
									console.log("Loading "+encoding+" encoder...");
								},
								onEncoderLoaded: function(recorder, encoding) {
									// hide "loading encoder..." display
									console.log(encoding+" encoder loaded");
								}
							});
							recorder.setOptions({
								timeLimit:120,
								encodeAfterRecord:true,
								ogg: {quality: 0.5},
								mp3: {bitRate: 160}
							});
							recorder.onComplete = function(recorder, blob) { 
								var recordingDate = new Date();
								var recordingTime = recordingDate.getTime();
								var recordingId = "recording_"+recordingTime;
								var audioTag = document.getElementById("audio")
								var sound = document.createElement('audio');
								sound.controls = 'controls';
								var soundUrl = URL.createObjectURL(blob);
								sound.src = soundUrl;
								var paragraph = document.createElement("p");
								var text = document.createTextNode("Recording ("+(new Date())+"): ");
								audioTag.appendChild(paragraph);
								var anchor = document.createElement("a");
								anchor.href = soundUrl;
								anchor.download = recordingId;
								paragraph.appendChild(anchor);
								var text = document.createTextNode("Recording ("+recordingDate+"): ");
								anchor.appendChild(text);
								paragraph.appendChild(sound);
								paragraph.id = recordingId;
								blobToTranscript(blob, recordingId);
							}
							recorder.startRecording();
						}
					}
					function stopAudioCapture() {
						if(audioCaptureState=="recording") {
							audioCaptureState = "enabled"
							recorder.finishRecording()
						}
					}
			/** END AUDIO CAPTURE SECTION **/
			/** START SPEECH TO TEXT SECTION **/
				// initialize state
					var textConversionState = "disabled"
				// enable/disable speech-to-text conversion
					function toggleTextConversion() {
						if(textConversionState=="disabled") {
							textConversionState = "enabled"
							document.getElementById("toggleTextConversion").textContent = "Speech-to-Text Enabled"
						} else if(textConversionState=="enabled") {
							textConversionState = "disabled"
							document.getElementById("toggleTextConversion").textContent = "Speech-to-Text Disabled"
						}
					}
				// conversion functions
					function blobToTranscript(blob, recordingId) {
						if(textConversionState=="enabled") {
							blobToBase64(blob, convertSpeechToText, recordingId)
						}
					}
					function blobToBase64(blob, convertSpeechToText, recordingId) {
						var reader = new FileReader();
						reader.onload = function() {
							var dataUrl = reader.result;
							var base64 = dataUrl.split(',')[1];
							convertSpeechToText(base64, recordingId);
						};
						reader.readAsDataURL(blob);
					};
					function convertSpeechToText(base64, recordingId) {
						var message = 	{
											"config": {
												"languageCode": "en-US",
												"enableWordTimeOffsets": false,
												"enableAutomaticPunctuation": true,
												"model": "phone_call",
												"useEnhanced": true,
												"audio_channel_count": 1
											},
											"audio": {
												"content": base64
											}
										};
						var xmlhttp = new XMLHttpRequest();
						// TODO: replace this publicly visible API key with a more secure solution
						// TODO: figure out how to charge usage to the client's Google account instead of my own
						var theUrl = "https://speech.googleapis.com/v1/speech:recognize?key=AIzaSyBgsX5jnnYjDPwtSuSlLrRsW50x3tFdmCA";
						xmlhttp.onreadystatechange = function() {
							if (xmlhttp.readyState === 4) {
								console.log(xmlhttp.response)
								// TODO: with my current subscription this will only work for up to one minute of audio (could notify the user, provide hard constraints on the recording, try to split recording up into pieces, push the recording to google cloud, try out the continuous transcription api, bump up the limit, provide meaningful error messages back to user)
								var results = JSON.parse(xmlhttp.response)["results"]
								var transcript = "Transcript:"
								for(var k=0; k<results.length; k++) {
									transcript += " " + results[k]["alternatives"][0]["transcript"]
								}
								displayTranscript(transcript, recordingId)
							}
						}
						xmlhttp.open("POST", theUrl);
						xmlhttp.setRequestHeader("Content-Type", "application/json");
						xmlhttp.send(JSON.stringify(message));
					}
					function displayTranscript(transcript, recordingId) {
						var paragraph = document.getElementById(recordingId)
						var text = document.createTextNode(transcript);
						paragraph.appendChild(text);
						// TODO: try to relate this event back to the pause/stop events that gave rise to it
						logEvent("guidedsilhouette",["event=speechToText","eventId="+recordingId,"eventText="+transcript])
					}
			/** END SPEECH TO TEXT SECTION **/
			/** START GRAPHICS SECTION **/
				// Initialize static data
					// TODO: make this graphic more detailed and better-looking
					// TODO: create more detailed body parts, including front/back (eg chest vs back)
					// TODO: create detailed graphics for specific body parts (eg hand)
					var pathIdList = ["body","bodyOutline","leftFoot","leftLeg","pelvis","rightLeg","rightFoot","leftHand","rightHand","rightArm","leftArm","chest","head","neck","nose","leftEye","rightEye","lips","chin","leftCheek","rightCheek","leftJaw","rightJaw","forehead","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9","sideFace","lowerTeeth","lowerTeethOutline","upperTeeth","upperTeethOutline","tongue","tongueOutline","sinus","sinusOutline","sideFaceOutline","leftFootBottom","rightFootBottom","leftFootBall","rightFootBall","leftFootHeel","rightFootHeel","leftFootArch","rightFootArch","leftFootSole","rightFootSole","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeBright","leftSecondToeBright","leftMiddleToeBright","leftFourthToeBright","leftPinkyToeBright","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeBright","rightSecondToeBright","rightMiddleToeBright","rightFourthToeBright","rightPinkyToeBright","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"]
					var pathIdLookup = {
						"Left Hand": ["body","bodyOutline","leftHand"],
						"Right Hand": ["body","bodyOutline","rightHand"],
						"Left Arm": ["body","bodyOutline","leftArm"],
						"Right Arm": ["body","bodyOutline","rightArm"],
						"Head & Face": ["body","bodyOutline","head"],
						"Neck & Shoulders": ["body","bodyOutline","neck"],
						"Chest & Back": ["body","bodyOutline","chest"],
						"Pelvis & Belly": ["body","bodyOutline","pelvis"],
						"Left Leg": ["body","bodyOutline","leftLeg"],
						"Right Leg": ["body","bodyOutline","rightLeg"],
						"Left Foot": ["body","bodyOutline","leftFoot"],
						"Right Foot": ["body","bodyOutline","rightFoot"],
						"Chin": ["chin","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Forehead": ["forehead","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Jaw Muscles": ["leftJaw","rightJaw","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Left Cheek": ["leftCheek","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Right Cheek": ["rightCheek","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Left Eye": ["leftEye","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Right Eye": ["rightEye","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Lips": ["lips","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Nose": ["nose","facePart1","facePart1Outline","facePart2","facePart3","facePart4","facePart5","facePart6","facePart7","facePart8","facePart9"],
						"Teeth & Gums": ["sideFace","lowerTeeth","lowerTeethOutline","upperTeeth","upperTeethOutline","tongueOutline","sinusOutline","sideFaceOutline"],
						"Throat & Sinuses": ["sideFace","lowerTeethOutline","upperTeethOutline","tongueOutline","sinus","sinusOutline","sideFaceOutline"],
						"Tongue & Mouth": ["sideFace","lowerTeethOutline","upperTeethOutline","tongue","tongueOutline","sinusOutline","sideFaceOutline"],
						"Digestion": ["body","bodyOutline"],
						"Heart & Pulse": ["body","bodyOutline"],
						"Lungs & Breath": ["body","bodyOutline"],
						"Eye Direction": ["body","bodyOutline"],
						"On Mind": ["body","bodyOutline"], // TODO: what to do with scan items that cannot be highlighted on a diagram?
						"Gravity": ["body","bodyOutline"],
						"Cloth": ["body","bodyOutline"],
						"Heat & Cold": ["body","bodyOutline"],
						"Tesion & Relaxation": ["body","bodyOutline"],
						"Sounds": ["body","bodyOutline"],
						"Inner Voice": ["body","bodyOutline"],
						"Fast Scan": ["body","bodyOutline"],
						"Mood": ["body","bodyOutline"],
						"Left Big Toe": ["leftBigToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Second Toe": ["leftSecondToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Middle Toe": ["leftMiddleToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Fourth Toe": ["leftFourthToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Pinky Toe": ["leftPinkyToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Big Toe": ["rightBigToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Second Toe": ["rightSecondToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Middle Toe": ["rightMiddleToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Fourth Toe": ["rightFourthToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Pinky Toe": ["rightPinkyToeBright","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Foot Ball": ["leftFootBall","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Foot Heel": ["leftFootHeel","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Left Foot Arch": ["leftFootArch","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Foot Ball": ["rightFootBall","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Foot Heel": ["rightFootHeel","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"],
						"Right Foot Arch": ["rightFootArch","leftFootBottom","rightFootBottom","leftFootBottomOutline","rightFootBottomOutline","leftBigToeDark","leftSecondToeDark","leftMiddleToeDark","leftFourthToeDark","leftPinkyToeDark","leftBigToeOutline","leftSecondToeOutline","leftMiddleToeOutline","leftFourthToeOutline","leftPinkyToeOutline","rightBigToeDark","rightSecondToeDark","rightMiddleToeDark","rightFourthToeDark","rightPinkyToeDark","rightBigToeOutline","rightSecondToeOutline","rightMiddleToeOutline","rightFourthToeOutline","rightPinkyToeOutline"]
					}
					var bodyPartCategoryList = ["Body","Systems","Face","Left Foot","Right Foot"]
					var bodyPartCategoryListAbbreviated = ["body","system","face","leftFoot","rightFoot"]
					var bodyPartCategoryLookup = {
						"Body": ["Head & Face","Neck & Shoulders","Chest & Back",
								"Left Arm","Right Arm","Left Hand","Right Hand",
								"Pelvis & Belly","Left Leg","Right Leg","Left Foot",
								"Right Foot"],
						"Systems": ["Digestion","Heart & Pulse","Lungs & Breath",
								"Eye Direction","On Mind","Gravity","Cloth",
								"Heat & Cold","Tesion & Relaxation","Sounds",
								"Inner Voice","Fast Scan","Mood"],
						"Face": ["Forehead","Jaw Muscles","Left Eye","Right Eye",
								"Left Cheek","Right Cheek","Nose","Lips","Chin",
								"Throat & Sinuses","Tongue & Mouth","Teeth & Gums"],
						"Left Foot": ["Left Big Toe","Left Second Toe","Left Middle Toe","Left Fourth Toe","Left Pinky Toe","Left Foot Ball","Left Foot Heel","Left Foot Arch"],
						"Right Foot": ["Right Big Toe","Right Second Toe","Right Middle Toe","Right Fourth Toe","Right Pinky Toe","Right Foot Ball","Right Foot Heel","Right Foot Arch"]
					}
				// Initialize graphic elements
					darkenSilhouette()
					function darkenSilhouette() {
						setVisible(["body","bodyOutline"])
					}
					function setVisible(visiblePartList) {
						for(var k=0; k<visiblePartList.length; k++) {
							var visiblePart = visiblePartList[k]
							document.getElementById(visiblePart+"PathId").style.visibility = "visible"
						}
						for(var k=0; k<pathIdList.length; k++) {
							var pathIdPrefix = pathIdList[k]
							// TODO: this "includes" function is probably not all that scalable, and may not be portable
							if(!visiblePartList.includes(pathIdPrefix)) {
								document.getElementById(pathIdPrefix+"PathId").style.visibility = "hidden"
							}
						}
					}
					function brightenBodyPartElements(bodyPart) {
						var pathPrefixList = pathIdLookup[bodyPart]
						setVisible(pathPrefixList)
					}
					createOptions()
					function createOptions() {
						var paragraph = document.getElementById("options")
						for(var k=0; k<bodyPartCategoryList.length; k++) {
							var bodyPartCategory = bodyPartCategoryList[k]
							var shortCatName = bodyPartCategoryListAbbreviated[k]
							var bodySpan = document.createElement("span")
							bodySpan.id = shortCatName+"Header"
							bodySpan.innerHTML = "&nbsp;<input type='checkbox' id='"+shortCatName+"HeaderCheckbox' onClick='handleCheckboxEvent(event)'> Category: "+bodyPartCategory+" &nbsp;[Expand <input type='checkbox' id='"+shortCatName+"ExpandCheckbox' onClick='handleCheckboxEvent(event)'>]<br/>"
							paragraph.appendChild(bodySpan)
							if(shortCatName=="body") {
								document.getElementById(shortCatName+"HeaderCheckbox").checked = true
							}
							var bodyPartsList = bodyPartCategoryLookup[bodyPartCategory]
							for(var j=0; j<bodyPartsList.length; j++) {
								var bodyPart = bodyPartsList[j]
								var bodyPartSpan = document.createElement("span")
								// TODO: these id's should not have spaces in them
								bodyPartSpan.id = bodyPart+" Span"
								bodyPartSpan.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='checkbox' id='"+bodyPart+" Checkbox' onClick='handleCheckboxEvent(event)'> "+bodyPart+"<br>"
								bodyPartSpan.style.display = "none"
								paragraph.appendChild(bodyPartSpan)
								if(shortCatName=="body") {
									document.getElementById(bodyPart+" Checkbox").checked = true
								}
							}
						}
					}
					function handleCheckboxEvent(event) {
						var targetId = event.target.id
						for(var k=0; k<bodyPartCategoryList.length; k++) {
							var bodyPartCategory = bodyPartCategoryList[k]
							var shortCatName = bodyPartCategoryListAbbreviated[k]
							var bodyPartsList = bodyPartCategoryLookup[bodyPartCategory]
							if(targetId==shortCatName+"HeaderCheckbox") {
								var checkboxValue = document.getElementById(targetId).checked
								for(var j=0; j<bodyPartsList.length; j++) {
									var bodyPartCheckbox = document.getElementById(bodyPartsList[j]+" Checkbox")
									bodyPartCheckbox.checked = checkboxValue
								}
							}
							if(targetId==shortCatName+"ExpandCheckbox") {
								var checkboxValue = document.getElementById(targetId).checked
								for(var j=0; j<bodyPartsList.length; j++) {
									var bodyPartSpan = document.getElementById(bodyPartsList[j]+" Span")
									if(checkboxValue) {
										bodyPartSpan.style.display = "block"
									} else {
										bodyPartSpan.style.display = "none"
									}
								}
							}
						}
					}
					function isChecked(bodyPart) {
						return document.getElementById(bodyPart+" Checkbox").checked
					}
				// Display active graphics
					function brightenBodyPart(bodyPart) {
						brightenBodyPartElements(bodyPart)
						displayBodyPartName(bodyPart)
						logEvent("guidedsilhouette",["event=brightenBodyPart","bodyPart="+bodyPart])
					}
					var lastBodyPart = ""
					function brightenRandomBodyPart() {
						darkenSilhouette()
						// TODO: implement optional body part clustering, where consecutive body parts will tend to be in the same region
						var bodyParts = []
						for(var k=0; k<bodyPartCategoryList.length; k++) {
							var bodyPartCategory = bodyPartCategoryList[k]
							var bodyPartsList = bodyPartCategoryLookup[bodyPartCategory]
							for(var j=0; j<bodyPartsList.length; j++) {
								var bodyPart = bodyPartsList[j]
								if(bodyPart!=lastBodyPart&&isChecked(bodyPart)) {
									bodyParts.push(bodyPart)
								}
							}
						}
						// TODO: how best to handle if the selection list is empty?
						if(bodyParts.length==0&&lastBodyPart!=""&&isChecked(lastBodyPart)) {
							bodyParts.push(lastBodyPart)
						}
						if(bodyParts.length==0) {
							bodyParts.push("Head & Face")
						}
						var index = Math.floor(Math.random()*bodyParts.length)
						var newBodyPart = bodyParts[index]
						lastBodyPart = newBodyPart
						brightenBodyPart(newBodyPart)
					}
					function displayBodyPartName(bodyPart) {
						if(bodyPart=="Click Somewhere") {
							document.getElementById("bodypart").textContent = "Click somewhere on the body"
							logEvent("guidedsilhouette",["event=clickSomewhere"])
						} else if(bodyPart=="Unpause") {
							document.getElementById("bodypart").textContent = "The game is paused"
						} else if(bodyPart=="Stopped") {
							document.getElementById("bodypart").textContent = "The game is stopped"
							return
						} else {
							document.getElementById("bodypart").textContent = "Focus on your "+bodyPart
						}
						playAudio(bodyPart)
					}
			/** END GRAPHICS SECTION **/
		</script>
	</body>
</html>