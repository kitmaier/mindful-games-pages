<!DOCTYPE html>
<html>
	<head>
	</head>
	<body id='body'>
		<p><a href="index.html">Return to games index</a></p>
		<h1>Guided Body Scan</h1>
		<p>Direct your attention to sensations <br/>in the lightened part of the body below, <br/>looking at it as though it was in a mirror.</p>
		<svg id="svgId" height="200" width="200" onClick="clickPixel(event)">
			Sorry, your browser does not support inline SVG.
		</svg> 
		<p id="bodypart"></p>
		<script>
			function createPixels() {
				var svg = document.getElementById("svgId")
				for(var x=0; x<20; x++) {
					for(var y=0; y<20; y++) {
						var rect = document.createElementNS("http://www.w3.org/2000/svg","rect")
						rect.setAttribute("id","pixel_"+x+"_"+y)
						rect.setAttribute("x",x+"0")
						rect.setAttribute("y",y+"0")
						rect.setAttribute("width","10")
						rect.setAttribute("height","10")
						rect.setAttribute("style","fill:white;stroke:white;stroke-width:1")
						svg.appendChild(rect)
					}
				}
			}
			createPixels()
			var state = "randomized"
			function clickPixel(event) {
				// TODO: track how long it takes to respond
				var x = Math.floor(event.offsetX/10)
				var y = Math.floor(event.offsetY/10)
				if(state!="awaiting_click") {
					return
				}
				var bodyPart = pixelsReverseLookup[[x,y]]
				if(bodyPart===undefined) {
					return
				}
				brightenBodyPart(bodyPart)
				state = "randomized"
				var timeoutValue = 5+Math.floor(Math.random()*25)
				setTimeout(brightenOnRandomSchedule, timeoutValue*1000)
			}
			function setColorOnPixels(color,pixels) {
				try {
					for(var k=0; k<pixels.length; k++) {

						document.getElementById("pixel_"+pixels[k][0]+"_"+pixels[k][1]).setAttribute("style","fill:"+color+";stroke:"+color+";stroke-width:1")
					}
				} catch(error) {
					alert(error.message)
				}
			}
			function darkenSilhouette() {
				var pixels = [[8,2],[9,2],[10,2],
							  [8,3],[9,3],[10,3],
							  [8,4],[9,4],[10,4],
									[9,5],
						[7,6],[8,6],[9,6],[10,6],[11,6],
				  [6,7],[7,7],[8,7],[9,7],[10,7],[11,7],[12,7],
			[5,8],[6,8],[7,8],[8,8],[9,8],[10,8],[11,8],[12,8],[13,8],
	  [4,9],[5,9],      [7,9],[8,9],[9,9],[10,9],[11,9],       [13,9],[14,9],
[3,10],[4,10],        [7,10],[8,10],[9,10],[10,10],[11,10],          [14,10],[15,10],
[3,11],[4,11],        [7,11],[8,11],[9,11],[10,11],[11,11],          [14,11],[15,11],
					  [7,12],[8,12],       [10,12],[11,12],
					  [7,13],[8,13],       [10,13],[11,13],
					  [7,14],[8,14],       [10,14],[11,14],
					  [7,15],[8,15],       [10,15],[11,15],
			   [6,16],[7,16],[8,16],       [10,16],[11,16],[12,16],
			   [6,17],[7,17],[8,17],       [10,17],[11,17],[12,17]]
				setColorOnPixels("black",pixels)
				// TODO: make this graphic more detailed and better-looking
			}
			darkenSilhouette()
			// TODO: create more detailed body parts, including front/back (eg chest vs back)
			var pixelsLookup = {
				"Left Hand":[[3,10],[4,10],[3,11],[4,11]],
				"Right Hand":[[14,10],[15,10],[14,11],[15,11]],
				"Left Arm":[[4,9],[5,9],[5,8],[6,8],[6,7]],
				"Right Arm":[[12,7],[12,8],[13,8],[13,9],[14,9]],
				"Head & Face":[[8,2],[9,2],[10,2],[8,3],[9,3],[10,3],[8,4],[9,4],[10,4]],
				"Neck & Shoulders":[[9,5],[7,6],[8,6],[9,6],[10,6],[11,6]],
				"Chest & Back":[[7,7],[8,7],[9,7],[10,7],[11,7],[7,8],[8,8],[9,8],[10,8],[11,8],[7,9],[8,9],[9,9],[10,9],[11,9]],
				"Pelvis & Belly":[[7,10],[8,10],[9,10],[10,10],[11,10],[7,11],[8,11],[9,11],[10,11],[11,11]],
				"Left Leg":[[7,12],[8,12],[7,13],[8,13],[7,14],[8,14],[7,15],[8,15]],
				"Right Leg":[[10,12],[11,12],[10,13],[11,13],[10,14],[11,14],[10,15],[11,15]],
				"Left Foot":[[6,16],[7,16],[8,16],[6,17],[7,17],[8,17]],
				"Right Foot":[[10,16],[11,16],[12,16],[10,17],[11,17],[12,17]]
			}
			var pixelsReverseLookup = {}
			function createPixelsReverseLookup() {
				for(var bodyPart in pixelsLookup) {
					var pixelList = pixelsLookup[bodyPart]
					for(var k=0; k<pixelList.length; k++) {
						var pixelLoc = pixelList[k]
						pixelsReverseLookup[pixelLoc] = bodyPart
					}
				}
			}
			createPixelsReverseLookup()
			function displayBodyPartName(bodyPart) {
				document.getElementById("bodypart").textContent = "Focus on your "+bodyPart
			}
			function brightenBodyPart(bodyPart) {
				setColorOnPixels("yellow",pixelsLookup[bodyPart])
				displayBodyPartName(bodyPart)
			}
			function brightenRandomBodyPart() {
				darkenSilhouette()
				var index = Math.floor(Math.random()*12)
				var bodyParts = ["Left Hand","Right Hand","Left Arm","Right Arm","Head & Face","Neck & Shoulders","Chest & Back","Pelvis & Belly","Left Leg","Right Leg","Left Foot","Right Foot"]
				brightenBodyPart(bodyParts[index])
			}
			function brightenOnRandomSchedule() {
				if(Math.random()*13>1) {
					// TODO: allow timing parameters to be set by user
					brightenRandomBodyPart()
					var timeoutValue = 5+Math.floor(Math.random()*25)
					setTimeout(brightenOnRandomSchedule, timeoutValue*1000)
				} else {
					darkenSilhouette()
					document.getElementById("bodypart").textContent = "Click somewhere on the body"
					state = "awaiting_click"
				}
				// TODO: break in with other random events sometimes, such as instructions, questions, and reminders
			}
			brightenOnRandomSchedule()
		</script>
	</body>
</html>