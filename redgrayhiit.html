<!DOCTYPE html>
<html>
	<head>
	</head>
	<script>
		var state = "Start";
		var data = [];
		var colors = ["#FF0000", "#999999"];
		var colorIndex = -1;
		function changeColor() {
			var col = document.getElementById("body");
			colorIndex = Math.floor(Math.random()*2);
			col.style.backgroundColor = colors[colorIndex];
		}
		function myFunction(event) {
			if(state=="Wait") return;
			var x = event.key;
			if (x == "a" || x == "A") {
				data.push([(new Date).getTime(),colorIndex,"A"]);
			} else if (x == "d" || x == "D") {
				data.push([(new Date).getTime(),colorIndex,"D"]);
			} else {
				return;
			}
			document.getElementById("data").textContent = JSON.stringify(data);
			var index = 0;
			var duration = data[data.length-1][0]-data[index][0];
			var speed = (duration*0.001/(data.length-1-index)).toFixed(3);
			document.getElementById("speed").textContent = "Speed: " + speed + "s";
			index = 1;
			var countValid = 0;
			for(var k=index; k<data.length; k++) {
				if((data[k][1]==0&&data[k][2]=="A")||(data[k][1]==1&&data[k][2]=="D")) {
					countValid += 1;
				}
			}
			var accuracy = (countValid*100.0/(data.length-index)).toFixed(0);
			document.getElementById("accuracy").textContent = "Accuracy: " + accuracy + "%";
			changeColor();
		}
		function setGo() {
			if(state=="Go") return;
			state = "Go";
			setTimeout(setWait, 20*1000);
			document.getElementById("waitMessage").textContent = "GO!!!";
			data = [[(new Date).getTime()]];
			changeColor();
		}
		function setWait() {
			if(state=="Wait") return;
			state = "Wait";
			setTimeout(setGo, 20*1000);
			document.getElementById("waitMessage").textContent = "Wait for this to say GO...";
			document.getElementById("body").style.backgroundColor = "#DDDD00";
		}
		setWait()
	</script>
	<style> body { background-color: #DDDD00} </style>
	<body id='body' onkeyup="myFunction(event)">
		<p><a href="index.html">Return to games index</a></p>
		<h1 id='accuracy'>Accuracy: NaN%</h1>
		<h1 id='speed'>Speed: NaNs</h1>
		<p>The goal of this game is to go as fast as possible without making too many mistakes. 
		<br/>As you get comfortable, notice that your hand starts trying to predict the color ahead of time, leading to mistakes. 
		<br/>The color cannot be predicted ahead of time, because it is completely random.
		<br/>Focus on recognizing and suppressing that reaction, and trying to just go with what you see in front of you. 
		<br/>This game will go in intervals of 20 seconds off / 20 seconds on. 
		<br/>Tap the "A" key if you see red and the "D" key if you see gray.</p>
		<p id='waitMessage'><b>Wait for this to say GO...</b></p>
		<p id='data'></p>
		<!--button onclick="changeColor(); getTimestamp();">Change color</button-->
		<!--input type="text" size="40" onkeydown="myFunction(event)" id="textbox"/-->
	</body>
</html>