<!DOCTYPE html>
<html>
	<head>
	</head>
	<!-- TODO: this onkeydown event responds repeatedly when button is held, find out how to disable that -->
	<body id='body' onkeydown="myFunction(event)">
		<p><a href="index.html">Return to games index</a></p>
		<h1>Echoic Memory Game</h1>
		<p>-instructions-</p>
		<p id="sentence"></p>
		<p id="startPid">
			<button id="startButton" onclick="startGame()">Start</button>
		</p>
		<p id="svgPid" style="display:none"><svg id="svgId" height="20" width="200">
			<rect x="0" y="0" width="200" height="20" stroke="#000000" stroke-width="1" fill="#666666"></rect>
			<rect x="0" y="0" width="200" height="20" stroke="#9999FF" stroke-width="1" fill="#9999FF">
				<animate id="leftToRight" attributeName="width" from="0" to="200" dur="1s" begin="indefinite" fill="remove" />
			</rect>
			Sorry, your browser does not support inline SVG.
		</svg></p>
		<p id="textboxPid" style="display:none">
			<input type="text" id="textBox" value="" onKeyUp="submissionClick(event)">
			<button id="submitButton" onclick="receiveSubmission()">Submit</button>
		</p>
		<p id="results"></p>
		<script>
			// TODO: allow the user to select the difficulty (number of words per sentence)
			// TODO: ping service or some other website to get each sentence
			/* TODO: basic functionality
						-create list of sentences
						-display and tag random sentence
						-allow user to kick off test by hitting start button, and blank out sentence
						-display some kind of timer or countdown
						-display input text box and submission button
						display accuracy score and start over
						display comparison of submitted answer and right answer
			*/
			var sentenceIndex = 0
			// TODO: sentences with or without period? 
			var sentences = [	"The cat sat on the mat",
								"The rain in spain falls mainly on the plain",
								"The itsy bitsy spider climbed up the water spout"
							]
			pickSentence()
			function pickSentence() {
				sentenceIndex = Math.floor(Math.random()*sentences.length)
				document.getElementById("sentence").textContent = sentences[sentenceIndex]
				document.getElementById("sentence").style.display = "block"
				document.getElementById("startPid").style.display = "block"
			}
			function startGame() {
				document.getElementById("startPid").style.display = "none"
				document.getElementById("sentence").style.display = "none"
				showTimerBar()
			}
			function showTimerBar() {
				var duration = Math.floor(Math.random()*10)+5
				document.getElementById("leftToRight").setAttribute("dur",duration+"s")
				document.getElementById("leftToRight").beginElement()
				document.getElementById("svgPid").style.display = "block"
				setTimeout(hideTimerBar,duration*1000)
			}
			function hideTimerBar() {
				document.getElementById("svgPid").style.display = "none"
				showTextBox()
			}
			function showTextBox() {
				document.getElementById("textBox").value = ""
				document.getElementById("textboxPid").style.display = "block"
			}
			function submissionClick(event) {
				if(event.keyCode==13) {
					receiveSubmission()
					// TODO: make this box invisible when not in use, and visible when asking for submission
				}
			}
			function receiveSubmission() {
				var submission = document.getElementById("textBox").value
				document.getElementById("textBox").value = ""
				document.getElementById("textboxPid").style.display = "none"
				scoreSubmission(submission)
				// TODO: validate/grade submission
				// TODO: store/display event log data
				pickSentence()
			}
			function scoreSubmission(submission) {
				// TODO: trim and canonicalize submission before comparison 
				// TODO: replace paragraphs with line breaks and improve formatting
				var paragraph1 = document.createElement("p");
				var text1 = document.createTextNode(sentences[sentenceIndex]);
				paragraph1.appendChild(text1);
				document.getElementById("results").appendChild(paragraph1)
				var paragraph2 = document.createElement("p");
				var text2 = document.createTextNode(submission);
				paragraph2.appendChild(text2);
				document.getElementById("results").appendChild(paragraph2)
				if(submission==sentences[sentenceIndex]) {
					paragraph2.style.color = "#00FF00"
				} else {
					paragraph2.style.color = "#FF0000"
				}
			}
		</script>
	</body>
</html>